name: Generate Dizipal M3U Playlist

# 襤 ak覺覺n覺 manuel olarak tetikleme ve her g羹n gece yar覺s覺 (UTC) 癟al覺t覺rma
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

# Bu izin, i ak覺覺n覺n depoya deiiklik (commit) yapmas覺na olanak tan覺r.
permissions:
  contents: write

jobs:
  scrape_and_update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Selenium'un kullanaca覺 Chrome taray覺c覺s覺n覺 kurar.
      - name: Setup Chrome for Selenium
        uses: browser-actions/setup-chrome@latest
        with:
          chrome-version: 'stable'

      # Python ortam覺n覺 haz覺rlar.
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # Ba覺ml覺l覺klar覺 y羹kler (Sizin listenize g繹re g羹ncellendi)
      - name: Install Dependencies
        run: |
          # pip'i g羹nceller
          python -m pip install --upgrade pip
          # Gerekli t羹m k羹t羹phaneleri tek seferde y羹kler
          pip install requests beautifulsoup4 cloudscraper selenium webdriver-manager

      # 'EOF' hatas覺 i癟in d羹zeltilmi placeholder oluturma ad覺m覺
      # dizipal/diziler.json dosyas覺n覺 (yoksa) oluturur.
      - name: Create Placeholder diziler.json (if missing)
        run: |
          mkdir -p dizipal
          if [ ! -f dizipal/diziler.json ]; then
            cat << 'EOF' > dizipal/diziler.json
{
  "/dizi-ornegi-yolu": {
    "group": "Ornek Dizi",
    "tvg-logo": "https://placehold.co/100x100/000/fff?text=LOGO"
  }
}
EOF
            echo "Placeholder diziler.json created."
          fi
          
      # Python betiini 癟al覺t覺r覺r (Dosya ad覺: a.py)
      - name: Run Scraper Script
        run: python a.py

      # Oluturulan M3U dosyas覺n覺 depoya kaydeder.
      - name: Commit and Push M3U file
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: " Update dizipalyerlidizi.m3u playlist"
          files: dizipalyerlidizi.m3u